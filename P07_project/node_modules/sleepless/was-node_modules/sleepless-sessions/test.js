
const { throwIf, } = require( "sleepless" )

// Test local module
const {
    register,
    unregister,
    authenticate,
    get_user,
    get_session,
    freshen_session,
    end_session,
    reset_password_code,
    reset_password,
} = require( "." ).local;

function fail( error ) { throw new Error( "FAIL: " + error ); }

register( "test@example.com", "test", "TEst1234", r => {
    throwIf( r.error, r.error );
    authenticate( "test", "TEst1234", r => {
        throwIf( r.error, r.error );
        get_session( r.session.sid, r => {
            throwIf( r.error, r.error );
            freshen_session( r.session.sid, r => {
                throwIf( r.error, r.error );
                end_session( r.session.sid, r => {
                    throwIf( r.error, r.error );
                    unregister( "test", "TEst1234", r => {
                        throwIf( r.error, r.error );
                        log( "All tests done" );
                    } );
                } );
            } );
        } );
    }, fail );
}, fail ); 



